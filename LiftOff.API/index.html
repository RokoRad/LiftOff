<!DOCTYPE html>
<html>
<head>
	<title>SignalR Simple Chat</title>
	<style type="text/css">
		.container {
			background-color: #99CCFF;
			border: thick solid #808080;
			padding: 20px;
			margin: 20px;
		}
	</style>
</head>
<body>
<div class="container">
	<input type="text" id="newLatitude" />
	<input type="text" id="newLongitude"/>
	<input type="button" id="sendmessage" value="Send" />
	<input type="hidden" id="latitude" />
	<input type="hidden" id="longitude" />
	<ul id="discussion"></ul>
</div>
<!--Script references. -->
<!--Reference the jQuery library. -->
<script src="Scripts/jquery-3.2.1.min.js"></script>
<!--Reference the SignalR library. -->
<script src="Scripts/jquery.signalR-2.2.2.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="signalr/hubs"></script>

<script type="text/javascript">
	$(function () {
		// Declare a proxy to reference the hub.
		var weather = $.connection.weatherHub;
		// Create a function that the hub can call to broadcast messages.
		weather.client.broadcastWeather =  function (weather) {
			var encodedMsg = $('<div />').text(weather).html();
			// Add the message to the page.
			$('#discussion').append('<li>' + encodedMsg + '</li>');
			console.log(weather);
        }; 

		$('#latitude').val(prompt('Enter your latitude:', ''));
        $('#longitude').val(prompt('Enter your longitude:', ''));

        $('#message').focus();

		$.connection.hub.start().done(function () {
            weather.server.initiateConnection({ Location: {Latitude: $('#latitude').val(), Longitude: $('#longitude').val()}, Date: $.now()}, "metric");
			$('#sendmessage').click(function () {
                //weather.server.updateLocation({ Location: { Latitude: $('#newLatitude').val(), Longitude: $('#newLongitude').val() }, Date: $.now() });
                weather.server.changeUnits();

				$('#newLatitude').val('').focus();
				$('#newLongitude').val('');
			});
		});
	});
</script>
</body>
</html>