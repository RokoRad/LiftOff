<!DOCTYPE html>
<html>
<head>
	<title>SignalR Simple Chat</title>
	<style type="text/css">
		.container {
			background-color: #99CCFF;
			border: thick solid #808080;
			padding: 20px;
			margin: 20px;
		}
	</style>
</head>
<body>
<div class="container">
	<input type="text" id="newLatitude" />
	<input type="text" id="newLongitude"/>
	<input type="button" id="sendmessage" value="Send" />
	<input type="hidden" id="latitude" />
	<input type="hidden" id="longitude" />
	<ul id="discussion"></ul>
</div>
<!--Script references. -->
<!--Reference the jQuery library. -->
<script src="Scripts/jquery-3.2.1.min.js"></script>
<!--Reference the SignalR library. -->
<script src="Scripts/jquery.signalR-2.2.2.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="signalr/hubs"></script>

<script type="text/javascript">
	$(function () {
		// Declare a proxy to reference the hub.
		var weather = $.connection.weatherHub;
		// Create a function that the hub can call to broadcast messages.
		weather.client.broadcastWeather =  function (weather) {
			var encodedMsg = $('<div />').text(weather).html();
			// Add the message to the page.
			$('#discussion').append('<li>' + encodedMsg + '</li>');
			console.log(weather);
		}; 

		weather.client.broadcast =  function (weather) {
			$('#discussion').append('<li>' + weather + '</li>');
			console.log('aaa');
		};
		// Get the user name and store it to prepend to messages.
		$('#latitude').val(prompt('Enter your latitude:', ''));
		$('#longitude').val(prompt('Enter your longitude:', ''));
		// Set initial focus to message input box.
		$('#message').focus();
		// Start the connection.
		$.connection.hub.start().done(function () {
			console.log("connected");
			weather.server.initiateConnection($('#latitude').val(), $('#longitude').val());
			$('#sendmessage').click(function () {
				weather.server.updateLocation($('#newLatitude').val(), $('#newLongitude').val());

				$('#newLatitude').val('').focus();
				$('#newLongitude').val('');
			});
		});
	});
</script>
</body>
</html>